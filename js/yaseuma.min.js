(function(){window.helpers={isNullOrUndef:function(a){return"undefined"===typeof a||null===a?!0:!1},createEvent:function(a,e){var f=["on",e,"Listeners"].join(""),c=["add",e,"Listener"].join(""),b=["remove",e,"Listener"].join("");a[f]=[];a[c]=function(b){-1===a[f].indexOf(b)&&a[f].push(b)};a[b]=function(b){b=a[f].indexOf(b);-1!==b&&a[f].splice(b,1)};a["notify"+e]=function(){var b=arguments;a[f].forEach(function(a){a.apply(null,b)})}}}})();(function(){function a(a){a||(a=this.root());var d=this.tree.nodes(this.root()).reverse(),b=this.tree.links(d);d.forEach(function(a){a.y=50*a.depth});e(this.g,a,d);f(this.g,this.diagonal,a,b);d.forEach(function(a){a.x0=a.x;a.y0=a.y});return this}function e(a,d,b){a=a.selectAll("g.node").data(b,function(a){return a.id||(a.id=++h)});b=a.enter().append("g").attr("class",c).attr("transform",function(){return k(d.x0,d.y0)}).style("opacity",0);b.append("circle").attr("r",10);b.append("text").attr("dy",
".35em").text(function(a){return a.nodeChar});b.append("text").attr("y",function(a){return a.children?-18:18}).attr("dy",".35em").text(function(a){return a.nodeText});a.transition().duration(g).attr("class",c).attr("transform",function(a){return k(a.x,a.y)}).style("opacity",1);a.exit().transition().duration(g).attr("transform",function(){return k(d.x,d.y)}).style("opacity",0).remove()}function f(a,d,b,c){a=a.selectAll("path.link").data(c,function(a){return a.target.id});a.enter().insert("path","g").attr("class",
"link").attr("d",function(){var a={x:b.x0,y:b.y0};return d({source:a,target:a})}).style("opacity",0);a.transition().duration(g).attr("d",d).style("opacity",1);a.exit().transition().duration(g).attr("d",function(){var a={x:b.x,y:b.y};return d({source:a,target:a})}).style("opacity",0).remove()}function c(a){return a.className?"node "+a.className:"node"}function b(a){return function(){var d=["translate(",d3.event.translate,")scale(",d3.event.scale,")"].join("");a.attr("transform",d)}}function k(a,d){return["translate(",
a,",",d,")"].join("")}window.vtree=function(c,f,e){function g(){}var h=null,m=f-(d.left+d.right),q=e-(d.top+d.bottom);c=d3.select(c);g.tree=d3.layout.tree().size([m,q]);g.diagonal=d3.svg.diagonal().projection(function(a){return[a.x,a.y]});g.g=c.append("g").attr("transform",k(d.left,d.top));var r=d3.behavior.zoom().scaleExtent([.5,2]).on("zoom",b(g.g));c.classed("vtree",!0).style("width",f).style("height",e).call(r);g.root=function(a){if(!arguments.length)return h;h=a;h.x0=m/2;h.y0=q/2;return g};g.update=
a;return g};var d={top:30,right:20,bottom:20,left:20},g=400,h=0})();(function(){function a(a){this.src=a;this.lines=a.split("\n");this.reset()}function e(a){a.isLineStart=!0;a.col=0;a.row++;a.line=a.lines[a.row];a.line||(a.line="")}function f(a){a.lv--}window.y={};y.Lex=a;y.TOKEN={EOF:256,EOL:257,ID:258,NUMBER:259,STRING:260,START_BLOCK:270,END_BLOCK:271,IF:272,ELIF:273,ELSE:274,FOR:275,IN:276,WHILE:277,DEF:278,RETURN:279,BREAK:280,CONTINUE:281,OP_EQ:300,OP_NOT_EQ:301,OP_LE:302,OP_GE:303};var c=y.TOKEN,b=/^([ \t]+|[ \t]*#.*)/,k=[{type:c.START_BLOCK,re:/^(:)/,on:function(a){a.lv++}},
{type:c.OP_EQ,re:/^(==)/},{type:c.OP_NOT_EQ,re:/^(!=)/},{type:c.OP_LE,re:/^(<=)/},{type:c.OP_GE,re:/^(>=)/},{re:/^([=\+\-\*\/\(\),\[\]<>])/},{type:c.STRING,re:/^("(?:[^"\\]|\\.)*")/},{type:c.STRING,re:/^('(?:[^'\\]|\\.)*')/},{type:c.IF,re:/^(if)/},{type:c.ELIF,re:/^(elif)/},{type:c.ELSE,re:/^(else)/},{type:c.FOR,re:/^(for)/},{type:c.IN,re:/^(in)/},{type:c.WHILE,re:/^(while)/},{type:c.DEF,re:/^(def)/},{type:c.RETURN,re:/^(return)/},{type:c.BREAK,re:/^(break)/},{type:c.CONTINUE,re:/^(continue)/},{type:c.NUMBER,
re:/^(\d+)/},{type:c.ID,re:/^([a-zA-Z_]\w*)/}];a.prototype.reset=function(){this.row=this.col=0;this.line=this.lines[0];this.lv=0};a.prototype.getLv=function(){var a=0,b=this.line.match("^( *)");b&&(a=b[1].length);if(0!==a%4)throw"LV4 ERROR";return a/4};a.prototype.getRemain=function(){return this.line.substr(this.col)};a.prototype.getChar=function(){return this.line.substr(this.col,1)};a.prototype.skipSpace=function(){var a=this.getRemain().match(b);a&&(this.col+=a[1].length)};a.prototype.createToken=
function(a,b,c){"undefined"===typeof a&&(a=b[0].charCodeAt(0));a={type:a,lexeme:b,col:this.col,row:this.row};this.col+=b.length;c&&c(this);return a};a.prototype.getToken=function(){this.skipSpace();if(this.row>=this.lines.length)return 0<this.lv?this.createToken(c.END_BLOCK,"",f):this.createToken(c.EOF,"");if(this.col>=this.line.length)return this.createToken(c.EOL,"\n",e);if(this.isLineStart){var a=this.getLv();if(a>this.lv)throw["LV ERROR [curLv: ",this.lv,", newLv:",a,"]"].join("");if(a<this.lv)return this.createToken(c.END_BLOCK,
"",f);this.isLineStart=!1}for(a=0;a<k.length;a++){var b=k[a],h=this.getRemain().match(b.re);if(h)return this.createToken(b.type,h[1],b.on)}return this.createToken(c.EOF,"")}})();(function(){function a(a){this.type=y.AST.NUMBER;this.num=a;this.className="ast-number";this.nodeChar="N";this.nodeText=""+a}function e(a){this.type=y.AST.STRING;this.s=a;this.className="ast-string";this.nodeChar="S";this.nodeText=a}function f(a){this.type=y.AST.LIST;this.items=a;this.className="ast-list";this.nodeText="list";this.children=a}function c(b,t,c){t.type===y.AST.NUMBER&&c.type===y.AST.NUMBER?(b=w(b.lexeme,t.num,c.num),a.call(this,b)):(this.type=y.AST.OP2,this.op=b,this.left=t,this.right=
c,this.className="ast-op2",this.nodeChar=b.lexeme,this.children=[t,c])}function b(a){this.type=y.AST.VAR;this.idName=a;this.className="ast-var";this.nodeChar="V";this.nodeText=a}function k(a,b){this.type=y.AST.CALL;this.idName=a;this.args=b;this.className="ast-call";this.nodeChar="C";this.nodeText=a;this.children=[b]}function d(){this.type=y.AST.PASS;this.className="ast-pass";this.nodeText="pass"}function g(a,b,c){c=c||new d;this.type=y.AST.IF;this.cond=a;this.body=b;this.aElse=c;this.className="ast-keyword";
this.nodeText="if";this.children=[a,b,c]}function h(a,b,c){this.type=y.AST.FOR;this.aVar=a;this.aArray=b;this.body=c;this.className="ast-keyword";this.nodeText="for";this.children=[a,b,c]}function l(a,b){this.type=y.AST.WHILE;this.cond=a;this.body=b;this.className="ast-keyword";this.nodeText="while";this.children=[a,b]}function n(a){this.type=y.AST.RETURN;this.value=a;this.className="ast-keyword";this.nodeText="return";this.children=[a]}function p(a){this.returnValue=a;this.name="ReturnException"}
function u(){this.type=y.AST.BREAK;this.className="ast-keyword";this.nodeText="break"}function x(){this.name="BreakException"}function m(){this.type=y.AST.CONTINUE;this.className="ast-keyword";this.nodeText="continue"}function q(){this.name="ContinueException"}function r(a){this.type=y.AST.BLOCK;this.astList=a;this.className="ast-block";this.nodeText="block";this.children=a}function v(a,b,c){this.type=y.AST.DEF;this.funcName=a;this.params=b;this.body=c;this.className="ast-def";this.nodeText="def";
this.children=[a,b,c]}function w(a,b,c){switch(a){case "+":return b+c;case "-":return b-c;case "*":return b*c;case "/":return b/c;case "==":return b===c;case "!=":return b!==c;case "<":return b<c;case "<=":return b<=c;case ">":return b>c;case ">=":return b>=c;default:throw"unknown op: "+a;}}y.ast={ASTNumber:a,ASTString:e,ASTList:f,ASTOp2:c,ASTVar:b,ASTCall:k,ASTIf:g,ASTFor:h,ASTWhile:l,ASTReturn:n,ASTBreak:u,ASTContinue:m,ASTBlock:r,ASTDef:v};y.AST={NUMBER:300,STRING:301,LIST:302,DICT:303,OP2:310,
VAR:311,CALL:312,IF:320,FOR:321,WHILE:322,RETURN:323,BREAK:324,CONTINUE:325,DEF:326,PASS:400};a.prototype.exec=function(){return this.num};e.prototype.exec=function(){return this.s};f.prototype.exec=function(a){var b=[];this.items.forEach(function(c){b.push(c.exec(a))});return b};c.prototype.exec=function(a){var b=this.op.lexeme,c=this.right.exec(a);if("="===b)return a.vars(this.left.idName,c),c;a=this.left.exec(a);return w(b,a,c)};b.prototype.exec=function(a){return a.vars(this.idName)};k.prototype.exec=
function(a){var b=a.vars(this.idName),c=[];this.args.items.forEach(function(b){c.push(b.exec(a))});if("function"===typeof b)return b.apply(null,c);if(b.type!==y.AST.DEF)throw"could not call "+this.idName;for(var d=new y.Env(a),f=0;f<b.params.items.length;f++)d.vars(b.params.items[f].idName,c[f]);var e;try{b.body.exec(d)}catch(g){if("ReturnException"===g.name)e=g.returnValue;else throw g;}b=a.getTopLevelEnv();b.notifyDeleteEnv&&b.notifyDeleteEnv(a);return e};d.prototype.exec=function(){};g.prototype.exec=
function(a){this.cond.exec(a)?this.body.exec(a):this.aElse.exec(a)};h.prototype.exec=function(a){for(var b=this.aArray.exec(a),c=0;c<b.length;c++){a.vars(this.aVar.idName,b[c]);try{this.body.exec(a)}catch(d){if("BreakException"===d.name)break;else if("ContinueException"!==d.name)throw d;}}};l.prototype.exec=function(a){for(;this.cond.exec(a);)try{this.body.exec(a)}catch(b){if("BreakException"===b.name)break;else if("ContinueException"!==b.name)throw b;}};n.prototype.exec=function(a){a=this.value.exec(a);
throw new p(a);};u.prototype.exec=function(){throw new x;};m.prototype.exec=function(){throw new q;};r.prototype.exec=function(a){this.astList.forEach(function(b){b.exec(a)})};v.prototype.exec=function(a){a.vars(this.funcName.idName,this)}})();(function(){function a(a){this.lex=a;this.nextToken()}y.Parser=a;a.prototype.parse=function(){this.skipEOL();return this.token.type===y.TOKEN.EOF?null:this.parseStatement()};a.prototype.nextToken=function(){return this.token=this.lex.getToken()};a.prototype.skipEOL=function(){for(;this.token.type===y.TOKEN.EOL;)this.nextToken()}})();(function(){y.Parser.prototype.parseStatement=function(){switch(this.token.type){case y.TOKEN.IF:return this.parseIf();case y.TOKEN.FOR:return this.parseFor();case y.TOKEN.WHILE:return this.parseWhile();case y.TOKEN.DEF:return this.parseDef();case y.TOKEN.RETURN:return this.parseReturn();case y.TOKEN.BREAK:return this.parseBreak();case y.TOKEN.CONTINUE:return this.parseContinue();default:return this.parseExpression()}};y.Parser.prototype.parseBlock=function(){this.nextToken();if(this.token.type!==
y.TOKEN.EOL)throw"\u300cif \u6761\u4ef6:\u300d \u306e\u3042\u3068\u306f\u3001\u6539\u884c\u3092\u5165\u308c\u3066\u304f\u3060\u3055\u3044";this.nextToken();for(var a=[];this.token.type!==y.TOKEN.END_BLOCK;){this.skipEOL();if(this.token.type===y.TOKEN.END_BLOCK)break;var e=this.parseStatement();a.push(e)}this.nextToken();return new y.ast.ASTBlock(a)};y.Parser.prototype.parseIf=function(){this.nextToken();var a=this.parseExpression();if(this.token.type!==y.TOKEN.START_BLOCK)throw"\u300cif \u6761\u4ef6\u300d \u306e\u3042\u3068\u306e':'\u304c\u629c\u3051\u3066\u3044\u307e\u3059";
var e=this.parseBlock(),f=null;this.token.type===y.TOKEN.ELIF?f=this.parseIf():this.token.type===y.TOKEN.ELSE&&(this.nextToken(),f=this.parseBlock());return new y.ast.ASTIf(a,e,f)};y.Parser.prototype.parseFor=function(){this.nextToken();if(this.token.type!==y.TOKEN.ID)throw"for \u306e\u3042\u3068\u306f\u5909\u6570\u540d\u3092\u66f8\u3044\u3066\u304f\u3060\u3055\u3044";var a=new y.ast.ASTVar(this.token.lexeme);this.nextToken();if(this.token.type!==y.TOKEN.IN)throw"for \u306b in \u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f";
this.nextToken();var e=this.parseExpression();if(this.token.type!==y.TOKEN.START_BLOCK)throw"\u300cfor\u300d \u306e\u3042\u3068\u306e':'\u304c\u629c\u3051\u3066\u3044\u307e\u3059";var f=this.parseBlock();return new y.ast.ASTFor(a,e,f)};y.Parser.prototype.parseWhile=function(){this.nextToken();var a=this.parseExpression();if(this.token.type!==y.TOKEN.START_BLOCK)throw"\u300cwhile \u6761\u4ef6\u300d \u306e\u3042\u3068\u306e':'\u304c\u629c\u3051\u3066\u3044\u307e\u3059";var e=this.parseBlock();return new y.ast.ASTWhile(a,
e)};y.Parser.prototype.parseReturn=function(){this.nextToken();var a=this.parseExpression();if(this.token.type!==y.TOKEN.EOL)throw"\u300creturn \u623b\u308a\u5024\u300d\u306e\u3042\u3068\u306b\u6539\u884c\u4ee5\u5916\u306e\u6587\u5b57\u304c\u3042\u308a\u307e\u3059";this.nextToken();return new y.ast.ASTReturn(a)};y.Parser.prototype.parseBreak=function(){this.nextToken();if(this.token.type!==y.TOKEN.EOL)throw"break \u306e\u3042\u3068\u306b\u6539\u884c\u4ee5\u5916\u306e\u6587\u5b57\u304c\u3042\u308a\u307e\u3059";
this.nextToken();return new y.ast.ASTBreak};y.Parser.prototype.parseContinue=function(){this.nextToken();if(this.token.type!==y.TOKEN.EOL)throw"continue \u306e\u3042\u3068\u306b\u6539\u884c\u4ee5\u5916\u306e\u6587\u5b57\u304c\u3042\u308a\u307e\u3059";this.nextToken();return new y.ast.ASTContinue};y.Parser.prototype.parseDef=function(){this.nextToken();if(this.token.type!==y.TOKEN.ID)throw"def \u306e\u3042\u3068\u306b\u306f\u95a2\u6570\u540d\u3092\u66f8\u3044\u3066\u304f\u3060\u3055\u3044";var a=new y.ast.ASTVar(this.token.lexeme);
this.nextToken();if("("!==this.token.lexeme)throw"\u300cdef \u95a2\u6570\u540d\u300d \u306e\u3042\u3068\u306b '(' \u304c\u3042\u308a\u307e\u305b\u3093";this.nextToken();var e=[];if(")"!==this.token.lexeme)for(;;){if(this.token.type!==y.TOKEN.ID)throw"\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u306f\u5f15\u6570\u540d\u3092\u66f8\u3044\u3066\u304f\u3060\u3055\u3044";var f=new y.ast.ASTVar(this.token.lexeme);e.push(f);this.nextToken();if(")"===this.token.lexeme)break;if(","!==this.token.lexeme)throw"\u30d1\u30e9\u30e1\u30fc\u30bf\u30ea\u30b9\u30c8\u306b ',' \u304c\u629c\u3051\u3066\u3044\u307e\u3059\u3002";
this.nextToken()}this.nextToken();f=this.parseBlock();return new y.ast.ASTDef(a,new y.ast.ASTList(e),f)}})();(function(){var a={"=":5,"==":11,"!=":11,"<":11,"<=":11,">":11,">=":11,"+":21,"-":21,"*":41},e={"=":6,"==":10,"!=":10,"<":10,"<=":10,">":10,">=":10,"+":20,"-":20,"*":40};y.Parser.prototype.parseExpression=function(){var a=this.parsePrimary();return this.parseOp2RHS({left:0,right:0},a)};y.Parser.prototype.parseOp2RHS=function(a,c){for(;;){var b=this.getPrecedence();if(a.left>b.right)return c;var e=this.token;this.nextToken();var d=this.parsePrimary(),g=this.getPrecedence();b.left<g.right&&(d=this.parseOp2RHS(b,
d));c=new y.ast.ASTOp2(e,c,d)}};y.Parser.prototype.getPrecedence=function(){var f=this.token.lexeme;return f in a?{left:a[f],right:e[f]}:{left:-1,right:-1}}})();(function(){y.Parser.prototype.parsePrimary=function(){switch(this.token.type){case y.TOKEN.NUMBER:return this.parseNumber();case y.TOKEN.STRING:return this.parseString();case 45:return this.parseMinus();case 40:return this.parseParen();case y.TOKEN.ID:return this.parseID();case 91:return this.parseList();default:throw"\u3053\u3093\u306a\u30c8\u30fc\u30af\u30f3\u304c\u6765\u308b\u3068\u306f\u601d\u3063\u3066\u307e\u305b\u3093\u3067\u3057\u305f: "+this.token.lexeme;}};y.Parser.prototype.parseNumber=
function(){var a=parseInt(this.token.lexeme),a=new y.ast.ASTNumber(a);this.nextToken();return a};y.Parser.prototype.parseString=function(){var a=this.token.lexeme,a=a.substr(1,a.length-2),a=a.replace(/\\"/g,'"'),a=a.replace(/\\'/g,"'"),a=a.replace(/\\n/g,"\n"),a=a.replace(/\\t/g,"    "),a=new y.ast.ASTString(a);this.nextToken();return a};y.Parser.prototype.parseMinus=function(){this.nextToken();if(this.token.type!==y.TOKEN.NUMBER)throw"-\u306e\u3042\u3068\u3060\u304b\u3089\u3001\u6570\u5024\u304c\u6765\u308b\u3068\u601d\u3063\u3066\u307e\u3057\u305f";
var a=parseInt(this.token.lexeme),a=new y.ast.ASTNumber(-a);this.nextToken();return a};y.Parser.prototype.parseParen=function(){this.nextToken();var a=this.parseExpression();if(")"!==this.token.lexeme)throw"\u9589\u3058\u30ab\u30c3\u30b3 ')' \u304c\u629c\u3051\u3066\u3044\u307e\u3059\u3002";this.nextToken();return a};y.Parser.prototype.parseID=function(){var a=this.token.lexeme;this.nextToken();if("("!==this.token.lexeme)return new y.ast.ASTVar(a);this.nextToken();var e=[];if(")"!==this.token.lexeme)for(;;){var f=
this.parseExpression();e.push(f);if(")"===this.token.lexeme)break;if(","!==this.token.lexeme)throw"\u5f15\u6570\u30ea\u30b9\u30c8\u306b ',' \u304c\u629c\u3051\u3066\u3044\u307e\u3059\u3002";this.nextToken()}this.nextToken();return new y.ast.ASTCall(a,new y.ast.ASTList(e))};y.Parser.prototype.parseList=function(){this.nextToken();var a=[];if("]"!==this.token.lexeme)for(;;){var e=this.parseExpression();a.push(e);if("]"===this.token.lexeme)break;if(","!==this.token.lexeme)throw"\u914d\u5217\u30a2\u30a4\u30c6\u30e0\u306b ',' \u304c\u629c\u3051\u3066\u3044\u307e\u3059\u3002";
this.nextToken()}this.nextToken();return new y.ast.ASTList(a)}})();(function(){function a(a){this.parent=a;this.varsMap={};this.varsList=[];a=a?this.getTopLevelEnv():this;a.notifyNewEnv&&a.notifyNewEnv()}function e(a){window.console.log(a)}function f(a){return a.length}function c(){var a=[],c=0,d,e=1;if(1===arguments.length)d=arguments[0];else if(2===arguments.length)c=arguments[0],d=arguments[1];else if(3===arguments.length)c=arguments[0],d=arguments[1],e=arguments[2];else throw"range arguments number error";for(;c<d;c+=e)a.push(c);return a}y.Env=a;y.createTopLevelEnv=
function(){var b=new a;b.vars("print",e);b.vars("len",f);b.vars("range",c);helpers.createEvent(b,"ChangeVar");helpers.createEvent(b,"NewEnv");helpers.createEvent(b,"DeleteEnv");return b};a.prototype.vars=function(a,c){if(1>=arguments.length)return this.refVar(a);if(a in this.varsMap)var d=!1;else d=!0,this.varsList.push(a);this.varsMap[a]=c;var e=this.varsList.indexOf(a),f=this.getTopLevelEnv();f.notifyChangeVar&&f.notifyChangeVar(a,c,d,e);return this};a.prototype.varsForEach=function(a){var c=this.varsMap;
this.varsList.forEach(function(d){a(d,c[d])})};a.prototype.refVar=function(a){if(a in this.varsMap)return this.varsMap[a];if(this.parent)return this.parent.refVar(a);throw"undefined variable: "+a;};a.prototype.getTopLevelEnv=function(){return this.parent?this.parent.getTopLevelEnv():this}})();(function(){function a(){var a=document.getElementById("src").value;p="";l.innerHTML="";g=y.createTopLevelEnv();g.vars("print",function(a){p+=a.toString()+"\n";l.innerHTML=p;l.scrollTop=l.scrollHeight});var h=g;g=new y.Env(h);h.addNewEnvListener(e);h.addDeleteEnvListener(f);h.addChangeVarListener(c);a=new y.Lex(a);k=new y.Parser(a);try{d=k.parse()}catch(m){n.innerHTML=m}d?b.root(d).update():b.root({}).update()}function e(){for(var a=h.rows.length-1;0<a;a--)h.deleteRow(a)}function f(a){e();a.varsForEach(function(a,
b){c(a,b,!0,-1)})}function c(a,b,c,d){c?(d=h.rows.length-1,c=h.insertRow(-1),c.className="vars-"+d,c.insertCell(0),c.insertCell(1)):c=h.getElementsByClassName("vars-"+d)[0];b=b.type===y.AST.DEF?"[function "+b.funcName.idName+"]":b.toString();c.childNodes[0].innerHTML=a;c.childNodes[1].innerHTML=b}window.yaseuma=function(){l=document.getElementById("console");h=document.getElementById("vars-table");n=document.getElementById("err-message");var c=document.getElementById("ast-svg");b=vtree(c,840,600);
a()};window.stepRun=function(){d&&d.exec(g);try{d=k.parse()}catch(a){n.innerHTML=a}d?b.root(d).update():b.root({nodeText:"EOF"}).update()};window.loadSrc=a;var b,k,d,g,h,l,n,p=""})();
