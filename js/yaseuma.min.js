(function(){window.helpers={isNullOrUndef:function(a){return"undefined"===typeof a||null===a?!0:!1},createEvent:function(a,e){var f=["on",e,"Listeners"].join(""),b=["add",e,"Listener"].join(""),c=["remove",e,"Listener"].join("");a[f]=[];a[b]=function(c){-1===a[f].indexOf(c)&&a[f].push(c)};a[c]=function(c){c=a[f].indexOf(c);-1!==c&&a[f].splice(c,1)};a["notify"+e]=function(){var c=arguments;a[f].forEach(function(a){a.apply(null,c)})}},myEnum:function(a){for(var e=0,f=1;f<arguments.length;f++){var b=
arguments[f];"number"===typeof b?e=b:(a[b]=e,e++)}}}})();(function(){function a(a){a||(a=this.root());var d=this.tree.nodes(this.root()).reverse(),c=this.tree.links(d);d.forEach(function(a){a.y=50*a.depth});e(this.g,a,d);f(this.g,this.diagonal,a,c);d.forEach(function(a){a.x0=a.x;a.y0=a.y});return this}function e(a,d,c){a=a.selectAll("g.node").data(c,function(a){return a.id||(a.id=++g)});c=a.enter().append("g").attr("class",b).attr("transform",function(){return k(d.x0,d.y0)}).style("opacity",0);c.append("circle").attr("r",10);c.append("text").attr("dy",
".35em").text(function(a){return a.nodeChar});c.append("text").attr("y",function(a){return a.children?-18:18}).attr("dy",".35em").text(function(a){return a.nodeText});a.transition().duration(h).attr("class",b).attr("transform",function(a){return k(a.x,a.y)}).style("opacity",1);a.exit().transition().duration(h).attr("transform",function(){return k(d.x,d.y)}).style("opacity",0).remove()}function f(a,d,c,b){a=a.selectAll("path.link").data(b,function(a){return a.target.id});a.enter().insert("path","g").attr("class",
"link").attr("d",function(){var a={x:c.x0,y:c.y0};return d({source:a,target:a})}).style("opacity",0);a.transition().duration(h).attr("d",d).style("opacity",1);a.exit().transition().duration(h).attr("d",function(){var a={x:c.x,y:c.y};return d({source:a,target:a})}).style("opacity",0).remove()}function b(a){return a.className?"node "+a.className:"node"}function c(a){return function(){var d=["translate(",d3.event.translate,")scale(",d3.event.scale,")"].join("");a.attr("transform",d)}}function k(a,d){return["translate(",
a,",",d,")"].join("")}window.vtree=function(b,f,e){function h(){}var g=null,n=f-(d.left+d.right),t=e-(d.top+d.bottom);b=d3.select(b);h.tree=d3.layout.tree().size([n,t]);h.diagonal=d3.svg.diagonal().projection(function(a){return[a.x,a.y]});h.g=b.append("g").attr("transform",k(d.left,d.top));var u=d3.behavior.zoom().scaleExtent([.5,2]).on("zoom",c(h.g));b.classed("vtree",!0).style("width",f+"px").style("height",e+"px").call(u);h.root=function(a){if(!arguments.length)return g;g=a;g.x0=n/2;g.y0=t/2;return h};
h.update=a;return h};var d={top:30,right:20,bottom:20,left:20},h=400,g=0})();(function(){function a(a){this.src=a;this.lines=a.split("\n");this.reset()}function e(a){a.isLineStart=!0;a.col=0;a.row++;a.line=a.lines[a.row];a.line||(a.line="")}function f(a){a.lv--}window.y={};y.Lex=a;y.TOKEN={};helpers.myEnum(y.TOKEN,256,"EOF","EOL","ID","NUMBER","STRING","START_BLOCK","END_BLOCK","IF","ELIF","ELSE","FOR","IN","WHILE","DEF","RETURN","BREAK","CONTINUE","OP_EQ","OP_NOT_EQ","OP_LE","OP_GE");var b=y.TOKEN,c=/^([ \t]+|[ \t]*#.*)/,k=[{type:b.START_BLOCK,re:/^(:)/,on:function(a){a.lv++}},
{type:b.OP_EQ,re:/^(==)/},{type:b.OP_NOT_EQ,re:/^(!=)/},{type:b.OP_LE,re:/^(<=)/},{type:b.OP_GE,re:/^(>=)/},{re:/^([=\+\-\*\/\(\),\[\]<>])/},{type:b.STRING,re:/^("(?:[^"\\]|\\.)*")/},{type:b.STRING,re:/^('(?:[^'\\]|\\.)*')/},{type:b.IF,re:/^(if)/},{type:b.ELIF,re:/^(elif)/},{type:b.ELSE,re:/^(else)/},{type:b.FOR,re:/^(for)/},{type:b.IN,re:/^(in)/},{type:b.WHILE,re:/^(while)/},{type:b.DEF,re:/^(def)/},{type:b.RETURN,re:/^(return)/},{type:b.BREAK,re:/^(break)/},{type:b.CONTINUE,re:/^(continue)/},{type:b.NUMBER,
re:/^(\d+)/},{type:b.ID,re:/^([a-zA-Z_]\w*)/}];a.prototype.reset=function(){this.row=this.col=0;this.line=this.lines[0];this.lv=0};a.prototype.getLv=function(){var a=0,c=this.line.match("^( *)");c&&(a=c[1].length);if(0!==a%4)throw"LV4 ERROR";return a/4};a.prototype.getRemain=function(){return this.line.substr(this.col)};a.prototype.getChar=function(){return this.line.substr(this.col,1)};a.prototype.skipSpace=function(){var a=this.getRemain().match(c);a&&(this.col+=a[1].length)};a.prototype.createToken=
function(a,c,b){"undefined"===typeof a&&(a=c[0].charCodeAt(0));a={type:a,lexeme:c,col:this.col,row:this.row};this.col+=c.length;b&&b(this);return a};a.prototype.getToken=function(){this.skipSpace();if(this.row>=this.lines.length)return 0<this.lv?this.createToken(b.END_BLOCK,"",f):this.createToken(b.EOF,"");if(this.col>=this.line.length)return this.createToken(b.EOL,"\n",e);if(this.isLineStart){var a=this.getLv();if(a>this.lv)throw["LV ERROR [curLv: ",this.lv,", newLv:",a,"]"].join("");if(a<this.lv)return this.createToken(b.END_BLOCK,
"",f);this.isLineStart=!1}for(a=0;a<k.length;a++){var c=k[a],g=this.getRemain().match(c.re);if(g)return this.createToken(c.type,g[1],c.on)}return this.createToken(b.EOF,"")}})();(function(){function a(a){this.num=a;this.nodeText=""+a}function e(a){this.nodeText=this.s=a}function f(a){this.children=this.items=a}function b(a,c,b){this.op=a;this.left=c;this.right=b;this.nodeChar=a.lexeme;this.children=[c,b]}function c(a){this.nodeText=this.idName=a}function k(a,c){this.idName=a;this.args=c;this.nodeText=a;this.children=[c]}function d(){}function h(a,c,b){b=b||new d;this.cond=a;this.body=c;this.aElse=b;this.children=[a,c,b]}function g(a,c,b){this.aVar=a;this.aArray=c;this.body=
b;this.children=[a,c,b]}function l(a,c){this.cond=a;this.body=c;this.children=[a,c]}function p(a){this.value=a;this.children=[a]}function m(){}function q(){}function r(a){this.children=this.astList=a}function n(a,c,b){this.funcName=a;this.params=c;this.body=b;this.children=[a,c,b]}y.ast={ASTNumber:a,ASTString:e,ASTList:f,ASTOp2:b,ASTVar:c,ASTCall:k,ASTPass:d,ASTIf:h,ASTFor:g,ASTWhile:l,ASTReturn:p,ASTBreak:m,ASTContinue:q,ASTBlock:r,ASTDef:n};y.AST={};helpers.myEnum(y.AST,300,"NUMBER","STRING","LIST",
"DICT","OP2","VAR","CALL","IF","FOR","WHILE","RETURN","BREAK","CONTINUE","DEF","PASS");a.prototype.type=y.AST.NUMBER;a.prototype.className="ast-number";a.prototype.nodeChar="N";e.prototype.type=y.AST.STRING;e.prototype.className="ast-string";e.prototype.nodeChar="S";f.prototype.type=y.AST.LIST;f.prototype.className="ast-list";f.prototype.nodeText="list";b.prototype.type=y.AST.OP2;b.prototype.className="ast-op2";c.prototype.type=y.AST.VAR;c.prototype.className="ast-var";c.prototype.nodeChar="V";k.prototype.type=
y.AST.CALL;k.prototype.className="ast-call";k.prototype.nodeChar="C";d.prototype.type=y.AST.PASS;d.prototype.className="ast-pass";d.prototype.nodeText="pass";h.prototype.type=y.AST.IF;h.prototype.className="ast-keyword";h.prototype.nodeText="if";g.prototype.type=y.AST.FOR;g.prototype.className="ast-keyword";g.prototype.nodeText="for";l.prototype.type=y.AST.WHILE;l.prototype.className="ast-keyword";l.prototype.nodeText="while";p.prototype.type=y.AST.RETURN;p.prototype.className="ast-keyword";p.prototype.nodeText=
"return";m.prototype.type=y.AST.BREAK;m.prototype.className="ast-keyword";m.prototype.nodeText="break";q.prototype.type=y.AST.CONTINUE;q.prototype.className="ast-keyword";q.prototype.nodeText="continue";r.prototype.type=y.AST.BLOCK;r.prototype.className="ast-block";r.prototype.nodeText="block";n.prototype.type=y.AST.DEF;n.prototype.className="ast-def";n.prototype.nodeText="def"})();(function(){function a(a){this.lex=a;this.nextToken()}y.Parser=a;a.prototype.parse=function(){this.skipEOL();return this.token.type===y.TOKEN.EOF?null:this.parseStatement()};a.prototype.nextToken=function(){return this.token=this.lex.getToken()};a.prototype.skipEOL=function(){for(;this.token.type===y.TOKEN.EOL;)this.nextToken()}})();(function(){y.Parser.prototype.parseStatement=function(){switch(this.token.type){case y.TOKEN.IF:return this.parseIf();case y.TOKEN.FOR:return this.parseFor();case y.TOKEN.WHILE:return this.parseWhile();case y.TOKEN.DEF:return this.parseDef();case y.TOKEN.RETURN:return this.parseReturn();case y.TOKEN.BREAK:return this.parseBreak();case y.TOKEN.CONTINUE:return this.parseContinue();default:return this.parseExpression()}};y.Parser.prototype.parseBlock=function(){this.nextToken();if(this.token.type!==
y.TOKEN.EOL)throw"\u300cif \u6761\u4ef6:\u300d \u306e\u3042\u3068\u306f\u3001\u6539\u884c\u3092\u5165\u308c\u3066\u304f\u3060\u3055\u3044";this.nextToken();for(var a=[];this.token.type!==y.TOKEN.END_BLOCK;){this.skipEOL();if(this.token.type===y.TOKEN.END_BLOCK)break;var e=this.parseStatement();a.push(e)}this.nextToken();return new y.ast.ASTBlock(a)};y.Parser.prototype.parseIf=function(){this.nextToken();var a=this.parseExpression();if(this.token.type!==y.TOKEN.START_BLOCK)throw"\u300cif \u6761\u4ef6\u300d \u306e\u3042\u3068\u306e':'\u304c\u629c\u3051\u3066\u3044\u307e\u3059";
var e=this.parseBlock(),f=null;this.token.type===y.TOKEN.ELIF?f=this.parseIf():this.token.type===y.TOKEN.ELSE&&(this.nextToken(),f=this.parseBlock());return new y.ast.ASTIf(a,e,f)};y.Parser.prototype.parseFor=function(){this.nextToken();if(this.token.type!==y.TOKEN.ID)throw"for \u306e\u3042\u3068\u306f\u5909\u6570\u540d\u3092\u66f8\u3044\u3066\u304f\u3060\u3055\u3044";var a=new y.ast.ASTVar(this.token.lexeme);this.nextToken();if(this.token.type!==y.TOKEN.IN)throw"for \u306b in \u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f";
this.nextToken();var e=this.parseExpression();if(this.token.type!==y.TOKEN.START_BLOCK)throw"\u300cfor\u300d \u306e\u3042\u3068\u306e':'\u304c\u629c\u3051\u3066\u3044\u307e\u3059";var f=this.parseBlock();return new y.ast.ASTFor(a,e,f)};y.Parser.prototype.parseWhile=function(){this.nextToken();var a=this.parseExpression();if(this.token.type!==y.TOKEN.START_BLOCK)throw"\u300cwhile \u6761\u4ef6\u300d \u306e\u3042\u3068\u306e':'\u304c\u629c\u3051\u3066\u3044\u307e\u3059";var e=this.parseBlock();return new y.ast.ASTWhile(a,
e)};y.Parser.prototype.parseReturn=function(){this.nextToken();var a=this.parseExpression();if(this.token.type!==y.TOKEN.EOL)throw"\u300creturn \u623b\u308a\u5024\u300d\u306e\u3042\u3068\u306b\u6539\u884c\u4ee5\u5916\u306e\u6587\u5b57\u304c\u3042\u308a\u307e\u3059";this.nextToken();return new y.ast.ASTReturn(a)};y.Parser.prototype.parseBreak=function(){this.nextToken();if(this.token.type!==y.TOKEN.EOL)throw"break \u306e\u3042\u3068\u306b\u6539\u884c\u4ee5\u5916\u306e\u6587\u5b57\u304c\u3042\u308a\u307e\u3059";
this.nextToken();return new y.ast.ASTBreak};y.Parser.prototype.parseContinue=function(){this.nextToken();if(this.token.type!==y.TOKEN.EOL)throw"continue \u306e\u3042\u3068\u306b\u6539\u884c\u4ee5\u5916\u306e\u6587\u5b57\u304c\u3042\u308a\u307e\u3059";this.nextToken();return new y.ast.ASTContinue};y.Parser.prototype.parseDef=function(){this.nextToken();if(this.token.type!==y.TOKEN.ID)throw"def \u306e\u3042\u3068\u306b\u306f\u95a2\u6570\u540d\u3092\u66f8\u3044\u3066\u304f\u3060\u3055\u3044";var a=new y.ast.ASTVar(this.token.lexeme);
this.nextToken();if("("!==this.token.lexeme)throw"\u300cdef \u95a2\u6570\u540d\u300d \u306e\u3042\u3068\u306b '(' \u304c\u3042\u308a\u307e\u305b\u3093";this.nextToken();var e=[];if(")"!==this.token.lexeme)for(;;){if(this.token.type!==y.TOKEN.ID)throw"\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u306f\u5f15\u6570\u540d\u3092\u66f8\u3044\u3066\u304f\u3060\u3055\u3044";var f=new y.ast.ASTVar(this.token.lexeme);e.push(f);this.nextToken();if(")"===this.token.lexeme)break;if(","!==this.token.lexeme)throw"\u30d1\u30e9\u30e1\u30fc\u30bf\u30ea\u30b9\u30c8\u306b ',' \u304c\u629c\u3051\u3066\u3044\u307e\u3059\u3002";
this.nextToken()}this.nextToken();f=this.parseBlock();return new y.ast.ASTDef(a,new y.ast.ASTList(e),f)}})();(function(){var a={"=":5,"==":11,"!=":11,"<":11,"<=":11,">":11,">=":11,"+":21,"-":21,"*":41},e={"=":6,"==":10,"!=":10,"<":10,"<=":10,">":10,">=":10,"+":20,"-":20,"*":40};y.Parser.prototype.parseExpression=function(){var a=this.parsePrimary();return this.parseOp2RHS({left:0,right:0},a)};y.Parser.prototype.parseOp2RHS=function(a,b){for(;;){var c=this.getPrecedence();if(a.left>c.right)return b;var e=this.token;this.nextToken();var d=this.parsePrimary(),h=this.getPrecedence();c.left<h.right&&(d=this.parseOp2RHS(c,
d));b.type===y.AST.NUMBER&&d.type===y.AST.NUMBER?(c=y.runOp(e.lexeme,b.num,d.num),b=new y.ast.ASTNumber(c)):b=new y.ast.ASTOp2(e,b,d)}};y.Parser.prototype.getPrecedence=function(){var f=this.token.lexeme;return f in a?{left:a[f],right:e[f]}:{left:-1,right:-1}}})();(function(){y.Parser.prototype.parsePrimary=function(){switch(this.token.type){case y.TOKEN.NUMBER:return this.parseNumber();case y.TOKEN.STRING:return this.parseString();case 45:return this.parseMinus();case 40:return this.parseParen();case y.TOKEN.ID:return this.parseID();case 91:return this.parseList();default:throw"\u3053\u3093\u306a\u30c8\u30fc\u30af\u30f3\u304c\u6765\u308b\u3068\u306f\u601d\u3063\u3066\u307e\u305b\u3093\u3067\u3057\u305f: "+this.token.lexeme;}};y.Parser.prototype.parseNumber=
function(){var a=parseInt(this.token.lexeme),a=new y.ast.ASTNumber(a);this.nextToken();return a};y.Parser.prototype.parseString=function(){var a=this.token.lexeme,a=a.substr(1,a.length-2),a=a.replace(/\\"/g,'"'),a=a.replace(/\\'/g,"'"),a=a.replace(/\\n/g,"\n"),a=a.replace(/\\t/g,"    "),a=new y.ast.ASTString(a);this.nextToken();return a};y.Parser.prototype.parseMinus=function(){this.nextToken();if(this.token.type!==y.TOKEN.NUMBER)throw"-\u306e\u3042\u3068\u3060\u304b\u3089\u3001\u6570\u5024\u304c\u6765\u308b\u3068\u601d\u3063\u3066\u307e\u3057\u305f";
var a=parseInt(this.token.lexeme),a=new y.ast.ASTNumber(-a);this.nextToken();return a};y.Parser.prototype.parseParen=function(){this.nextToken();var a=this.parseExpression();if(")"!==this.token.lexeme)throw"\u9589\u3058\u30ab\u30c3\u30b3 ')' \u304c\u629c\u3051\u3066\u3044\u307e\u3059\u3002";this.nextToken();return a};y.Parser.prototype.parseID=function(){var a=this.token.lexeme;this.nextToken();if("("!==this.token.lexeme)return new y.ast.ASTVar(a);this.nextToken();var e=[];if(")"!==this.token.lexeme)for(;;){var f=
this.parseExpression();e.push(f);if(")"===this.token.lexeme)break;if(","!==this.token.lexeme)throw"\u5f15\u6570\u30ea\u30b9\u30c8\u306b ',' \u304c\u629c\u3051\u3066\u3044\u307e\u3059\u3002";this.nextToken()}this.nextToken();return new y.ast.ASTCall(a,new y.ast.ASTList(e))};y.Parser.prototype.parseList=function(){this.nextToken();var a=[];if("]"!==this.token.lexeme)for(;;){var e=this.parseExpression();a.push(e);if("]"===this.token.lexeme)break;if(","!==this.token.lexeme)throw"\u914d\u5217\u30a2\u30a4\u30c6\u30e0\u306b ',' \u304c\u629c\u3051\u3066\u3044\u307e\u3059\u3002";
this.nextToken()}this.nextToken();return new y.ast.ASTList(a)}})();(function(){function a(a){this.parent=a;this.varsMap={};this.varsList=[];a=a?this.getTopLevelEnv():this;a.notifyNewEnv&&a.notifyNewEnv()}function e(a){window.console.log(a)}function f(a){return a.length}function b(){var a=[],b=0,d,e=1;if(1===arguments.length)d=arguments[0];else if(2===arguments.length)b=arguments[0],d=arguments[1];else if(3===arguments.length)b=arguments[0],d=arguments[1],e=arguments[2];else throw"range arguments number error";for(;b<d;b+=e)a.push(b);return a}y.Env=a;y.createTopLevelEnv=
function(){var c=new a;c.vars("print",e);c.vars("len",f);c.vars("range",b);helpers.createEvent(c,"ChangeVar");helpers.createEvent(c,"NewEnv");helpers.createEvent(c,"DeleteEnv");return c};a.prototype.vars=function(a,b){if(1>=arguments.length)return this.refVar(a);if(a in this.varsMap)var d=!1;else d=!0,this.varsList.push(a);this.varsMap[a]=b;var e=this.varsList.indexOf(a),f=this.getTopLevelEnv();f.notifyChangeVar&&f.notifyChangeVar(a,b,d,e);return this};a.prototype.varsForEach=function(a){var b=this.varsMap;
this.varsList.forEach(function(d){a(d,b[d])})};a.prototype.refVar=function(a){if(a in this.varsMap)return this.varsMap[a];if(this.parent)return this.parent.refVar(a);throw"undefined variable: "+a;};a.prototype.getTopLevelEnv=function(){return this.parent?this.parent.getTopLevelEnv():this}})();(function(){function a(){var a=document.getElementById("src").value;m="";l.innerHTML="";h=y.createTopLevelEnv();h.vars("print",function(a){m+=a.toString()+"\n";l.innerHTML=m;l.scrollTop=l.scrollHeight});var g=h;h=new y.Env(g);g.addNewEnvListener(e);g.addDeleteEnvListener(f);g.addChangeVarListener(b);a=new y.Lex(a);k=new y.Parser(a);try{d=k.parse()}catch(n){p.innerHTML=n}d?c.root(d).update():c.root({}).update()}function e(){for(var a=g.rows.length-1;0<a;a--)g.deleteRow(a)}function f(a){e();a.varsForEach(function(a,
c){b(a,c,!0,-1)})}function b(a,b,c,d){c?(d=g.rows.length-1,c=g.insertRow(-1),c.className="vars-"+d,c.insertCell(0),c.insertCell(1)):c=g.getElementsByClassName("vars-"+d)[0];b=b.type===y.AST.DEF?"[function "+b.funcName.idName+"]":b.toString();c.childNodes[0].innerHTML=a;c.childNodes[1].innerHTML=b}window.yaseuma=function(){l=document.getElementById("console");g=document.getElementById("vars-table");p=document.getElementById("err-message");var b=document.getElementById("ast-svg");c=vtree(b,840,600);
a()};window.stepRun=function(){d&&d.exec(h);try{d=k.parse()}catch(a){p.innerHTML=a}d?c.root(d).update():c.root({nodeText:"EOF"}).update()};window.loadSrc=a;var c,k,d,h,g,l,p,m=""})();
