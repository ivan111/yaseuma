(function(){function d(a){if(a in f)var d=f[a];else d=new RegExp(["(?:^|\\s)",a,"(?!\\S)"].join("")),f[a]=d;return d}function c(a,c){var f=d(c);return a.className.match(f)?!0:!1}window.helpers={isNullOrUndef:function(a){return"undefined"===typeof a||null===a?!0:!1},isString:function(a){return"string"===typeof a||a instanceof String},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},createEvent:function(a,d){var c=["on",d,"Listeners"].join(""),h=["add",d,"Listener"].join(""),
b=["remove",d,"Listener"].join("");a[c]=[];a[h]=function(b){-1===a[c].indexOf(b)&&a[c].push(b)};a[b]=function(b){b=a[c].indexOf(b);-1!==b&&a[c].splice(b,1)};a["notify"+d]=function(){var b=arguments;a[c].forEach(function(a){a.apply(null,b)})}},myEnum:function(a){a.reverseMap=[];for(var d=0,c=1;c<arguments.length;c++){var h=arguments[c];"number"===typeof h?d=h:(a[h]=d,a.reverseMap[d]=h,d++)}},hasClass:c,addClass:function(a,d){c(a,d)||(a.className=""===a.className?d:a.className+(" "+d))},removeClass:function(a,
c){var f=d(c);a.className=a.className.replace(f,"")}};var f={}})();(function(){function d(b){b||(b=this.root());if(!b)return c(this.g),this;var d=this.tree.nodes(this.root()).reverse(),h=this.tree.links(d);d.forEach(function(b){b.y=50*b.depth});f(this.g,b,d);a(this.g,this.diagonal,b,h);d.forEach(function(b){b.x0=b.x;b.y0=b.y});return this}function c(b){b.selectAll("g.node").data([]).exit().transition().duration(k).style("opacity",0).remove();b.selectAll("path.link").data([]).exit().transition().duration(k).style("opacity",0).remove()}function f(a,d,c){a=a.selectAll("g.node").data(c,
function(b){return b.id||(b.id=++m)});c=a.enter().append("g").attr("class",g).attr("transform",function(){return b(d.x0,d.y0)}).style("opacity",0);c.append("circle").attr("r",10);c.append("text").attr("dy",".35em").text(function(b){return b.nodeChar});c.append("text").attr("class","node-text").attr("y",function(b){return b.children?-18:18}).attr("dy",".35em").text(function(b){return b.nodeText});a.transition().duration(k).attr("class",g).attr("transform",function(a){return b(a.x,a.y)}).style("opacity",
1);a.exit().transition().duration(k).attr("transform",function(){return b(d.x,d.y)}).style("opacity",0).remove()}function a(b,a,d,c){b=b.selectAll("path.link").data(c,function(b){return b.target.id});b.enter().insert("path","g").attr("class","link").attr("d",function(){var b={x:d.x0,y:d.y0};return a({source:b,target:b})}).style("opacity",0);b.transition().duration(k).attr("d",a).style("opacity",1);b.exit().transition().duration(k).attr("d",function(){var b={x:d.x,y:d.y};return a({source:b,target:b})}).style("opacity",
0).remove()}function e(b){d3.selectAll("g.node-"+b.id+" text.node-text").text(b.nodeText)}function g(b){return b.className?["node node-",b.id," "+b.className].join(""):"node node-"+b.id}function h(b){return function(){var a=["translate(",d3.event.translate,")scale(",d3.event.scale,")"].join("");b.attr("transform",a)}}function b(b,a){return["translate(",b,",",a,")"].join("")}window.vtree=function(a,c,f){function k(){}var g=null,m=c-(l.left+l.right),q=f-(l.top+l.bottom);a=d3.select(a);k.tree=d3.layout.tree().size([m,
q]);k.diagonal=d3.svg.diagonal().projection(function(b){return[b.x,b.y]});k.g=a.append("g").attr("transform",b(l.left,l.top));var r=d3.behavior.zoom().scaleExtent([.5,2]).on("zoom",h(k.g));a.classed("vtree",!0).style("width",c+"px").style("height",f+"px").call(r);k.root=function(b){if(!arguments.length)return g;if(g=b)g.x0=m/2,g.y0=q/2;return k};k.update=d;k.updateNodeText=e;return k};var l={top:30,right:20,bottom:20,left:20},k=400,m=0})();(function(){function d(b){this.src=b;this.lines=b.split("\n");this.reset()}function c(b){b.isLineStart=!0;b.col=0;b.row++;b.line=b.lines[b.row];b.line||(b.line="")}function f(b){b.lv--}window.y={};y.Lex=d;y.TOKEN={};helpers.myEnum(y.TOKEN,256,"EOF","EOL","ID","NUMBER","FLOAT","STRING","START_BLOCK","END_BLOCK","IF","ELIF","ELSE","FOR","IN","WHILE","DEF","RETURN","BREAK","CONTINUE","OP_EQ","OP_NOT_EQ","OP_LE","OP_GE","NEW");var a=y.TOKEN,e=/^([ \t]+|[ \t]*#.*)/,g=[{type:a.STRING,re:/^("(?:[^"\\]|\\.)*")/},
{type:a.STRING,re:/^('(?:[^'\\]|\\.)*')/},{type:a.START_BLOCK,re:/^(:)\s*$/,on:function(b){b.lv++}},{type:a.OP_EQ,re:/^(==)/},{type:a.OP_NOT_EQ,re:/^(!=)/},{type:a.OP_LE,re:/^(<=)/},{type:a.OP_GE,re:/^(>=)/},{type:a.OP_AND,re:/^(and)(?= )/},{type:a.OP_OR,re:/^(or)(?= )/},{type:a.OP_NOT,re:/^(not)(?= )/},{type:a.EOL,re:/^(;)/},{re:/^([=\+\-\*\/\(\),\[\]<>:\.{}])/},{type:a.IF,re:/^(if)\b/},{type:a.ELIF,re:/^(elif)\b/},{type:a.ELSE,re:/^(else)(?=[\s:])/},{type:a.FOR,re:/^(for)\b/},{type:a.IN,re:/^(in)\b/},
{type:a.WHILE,re:/^(while)\b/},{type:a.DEF,re:/^(def)\b/},{type:a.RETURN,re:/^(return)\b/},{type:a.BREAK,re:/^(break)\b/},{type:a.CONTINUE,re:/^(continue)\b/},{type:a.NEW,re:/^(new)\b/},{type:a.FLOAT,re:/^(\d*\.\d+)/},{type:a.NUMBER,re:/^(\d+)/},{type:a.ID,re:/^([a-zA-Z_]\w*)/}],h=[];d.prototype.reset=function(){this.row=this.col=0;this.line=this.lines[0];this.lv=0};d.prototype.getLv=function(){var b=0,a=this.line.match("^( *)");a&&(b=a[1].length);if(0!==b%4)throw"LV4 ERROR";return b/4};d.prototype.getRemain=
function(){return this.line.substr(this.col)};d.prototype.getChar=function(){return this.line.substr(this.col,1)};d.prototype.skipSpace=function(){var b=this.getRemain().match(e);b&&(this.col+=b[1].length)};d.prototype.createToken=function(b,a,d){"undefined"===typeof b&&(b=a[0].charCodeAt(0));var c=b;b=256>b?String.fromCharCode(b):b in y.TOKEN.reverseMap?y.TOKEN.reverseMap[b]:"unknown type";c={type:c,typeStr:b,lexeme:a,col:this.col,row:this.row,lineNo:this.row+1};this.col+=a.length;d&&d(this);return c};
d.prototype.getToken=function(){if(0<h.length)return h.pop();this.skipSpace();if(this.row>=this.lines.length)return 0<this.lv?this.createToken(a.END_BLOCK,"",f):this.createToken(a.EOF,"");if(this.col>=this.line.length)return this.createToken(a.EOL,"\n",c);if(this.isLineStart){var b=this.getLv();if(b>this.lv)throw["LV ERROR [curLv: ",this.lv,", newLv:",b,"]"].join("");if(b<this.lv)return this.createToken(a.END_BLOCK,"",f);this.isLineStart=!1}for(b=0;b<g.length;b++){var d=g[b],k=this.getRemain().match(d.re);
if(k)return this.createToken(d.type,k[1],d.on)}return this.createToken(a.EOF,"")}})();(function(){function d(b,a,d){d||(d=a);b.lineNo=a.lineNo;b.endLineNo=d.endLineNo?d.endLineNo:d.lineNo}function c(b,a){var c=a?parseFloat(b.lexeme):parseInt(b.lexeme);d(this,b);this.token=b;this.num=c;this.nodeText=""+c}function f(b){var a=b.lexeme,a=a.substr(1,a.length-2),a=a.replace(/\\"/g,'"'),a=a.replace(/\\'/g,"'"),a=a.replace(/\\n/g,"\n"),a=a.replace(/\\t/g,"    ");d(this,b);this.token=b;this.nodeText=this.s=a}function a(b,a,c){d(this,b,a);this.startToken=b;this.endToken=a;this.children=this.items=
c}function e(b,a,c,h){d(this,b,a);this.startToken=b;this.endToken=a;this.keys=c;this.values=h;b=[];for(a=0;a<c.length;a++)b.push({nodeText:"pair",children:[c[a],h[a]]});this.children=b}function g(b,a){d(this,b);this.opToken=b;this.op=b.lexeme;this.right=a;this.nodeChar=b.lexeme;this.children=[a]}function h(b,a,c){d(this,a);this.opToken=b;this.op=b.lexeme;this.left=a;this.right=c;this.nodeChar=b.lexeme;this.children=[a,c]}function b(b){d(this,b);this.token=b;this.nodeText=this.idName=b.lexeme}function l(b,
a,c){d(this,b);this.obj=b;this.start=a;this.children=(this.end=c)?[b,a,c]:[b,a]}function k(b,a){d(this,b);this.funcName=b.idName;this.args=a;this.children=[b,a]}function m(){}function p(b,a,c){c?d(this,b,c):d(this,b,a);c=c||new m;this.cond=b;this.body=a;this.aElse=c;this.children=[b,a,c]}function t(b,a,c){d(this,b,c);this.aVar=b;this.aArray=a;this.body=c;this.children=[b,a,c]}function n(b,a){d(this,b,a);this.cond=b;this.body=a;this.children=[b,a]}function u(b,a){d(this,b);this.token=b;if(this.value=
a)this.children=[a]}function v(b){d(this,b);this.token=b}function w(b){d(this,b);this.token=b}function q(b,a,c){d(this,b,a);this.startToken=b;this.endToken=a;this.children=this.astList=c}function r(b,a,c){d(this,b,c);this.funcName=b.idName;this.params=a;this.body=c;this.children=[b,a,c]}function x(b,a){d(this,b);this.obj=b;this.idAst=a;this.children=[b,a]}function z(b){d(this,b);this.astCall=b;this.children=[b]}y.ast={ASTNumber:c,ASTString:f,ASTList:a,ASTDict:e,ASTOp1:g,ASTOp2:h,ASTVar:b,ASTSlice:l,
ASTCall:k,ASTPass:m,ASTIf:p,ASTFor:t,ASTWhile:n,ASTReturn:u,ASTBreak:v,ASTContinue:w,ASTBlock:q,ASTDef:r,ASTMember:x,ASTNew:z};y.AST={};helpers.myEnum(y.AST,300,"NUMBER","STRING","LIST","DICT","OP1","OP2","VAR","SLICE","CALL","IF","FOR","WHILE","RETURN","BREAK","CONTINUE","DEF","PASS","MEMBER","NEW");c.prototype.type=y.AST.NUMBER;c.prototype.className="ast-number";c.prototype.nodeChar="N";f.prototype.type=y.AST.STRING;f.prototype.className="ast-string";f.prototype.nodeChar="S";a.prototype.type=y.AST.LIST;
a.prototype.className="ast-list";a.prototype.nodeText="list";e.prototype.type=y.AST.DICT;e.prototype.className="ast-dict";e.prototype.nodeText="dict";g.prototype.type=y.AST.OP1;g.prototype.className="ast-op";h.prototype.type=y.AST.OP2;h.prototype.className="ast-op";b.prototype.type=y.AST.VAR;b.prototype.className="ast-var";b.prototype.nodeChar="V";l.prototype.type=y.AST.SLICE;l.prototype.className="ast-var";l.prototype.nodeText="slice";k.prototype.type=y.AST.CALL;k.prototype.className="ast-call";
k.prototype.nodeText="call";m.prototype.type=y.AST.PASS;m.prototype.className="ast-pass";m.prototype.nodeText="pass";p.prototype.type=y.AST.IF;p.prototype.className="ast-keyword";p.prototype.nodeText="if";t.prototype.type=y.AST.FOR;t.prototype.className="ast-keyword";t.prototype.nodeText="for";n.prototype.type=y.AST.WHILE;n.prototype.className="ast-keyword";n.prototype.nodeText="while";u.prototype.type=y.AST.RETURN;u.prototype.className="ast-keyword";u.prototype.nodeText="return";v.prototype.type=
y.AST.BREAK;v.prototype.className="ast-keyword";v.prototype.nodeText="break";w.prototype.type=y.AST.CONTINUE;w.prototype.className="ast-keyword";w.prototype.nodeText="continue";q.prototype.type=y.AST.BLOCK;q.prototype.className="ast-block";q.prototype.nodeText="block";r.prototype.type=y.AST.DEF;r.prototype.className="ast-def";r.prototype.nodeText="def";x.prototype.type=y.AST.MEMBER;x.prototype.className="ast-member";x.prototype.nodeText="member";z.prototype.type=y.AST.NEW;z.prototype.className="ast-new";
z.prototype.nodeText="new"})();(function(){function d(a,b,c){var d=a.vars(b);if("function"===typeof d)return d.apply(null,c);if(d.type!==y.AST.DEF){try{window[b].apply(null,c)}catch(f){}throw"could not call "+b;}b=new y.Env(a);for(var e=0;e<d.params.items.length;e++)b.vars(d.params.items[e].idName,c[e]);var g;try{d.body.exec(b)}catch(n){if("ReturnException"===n.name)g=n.returnValue;else throw n;}c=a.getTopLevelEnv();c.notifyDeleteEnv&&c.notifyDeleteEnv(a);return g}function c(a){this.returnValue=a;this.name="ReturnException"}function f(){this.name=
"BreakException"}function a(){this.name="ContinueException"}function e(a,b,c){b.type===y.AST.VAR?a.vars(b.idName,c):b.obj.exec(a)[b.idAst.idName]=c}function g(a,b,c){switch(a){case "+":return b+c;case "-":return b-c;case "*":return b*c;case "/":return b/c;case "==":return b===c;case "!=":return b!==c;case "<":return b<c;case "<=":return b<=c;case ">":return b>c;case ">=":return b>=c;default:throw"unknown op: "+a;}}y.runOp=g;y.ast.ASTNumber.prototype.exec=function(){return this.num};y.ast.ASTString.prototype.exec=
function(){return this.s};y.ast.ASTList.prototype.exec=function(a){var b=[];this.items.forEach(function(c){b.push(c.exec(a))});return b};y.ast.ASTDict.prototype.exec=function(a){for(var b=[],c=0;c<this.keys.length;c++){var d=this.keys[c];switch(d.type){case y.AST.VAR:d=d.idName;break;case y.AST.STRING:d=d.s;break;case y.AST.NUMBER:d=""+d.num;break;default:throw"map key error: "+d;}b[d]=this.values[c].exec(a)}return b};y.ast.ASTOp1.prototype.exec=function(a){var b=this.op;a=this.right.exec(a);if("-"===
b)return-a;if("not"===b)return!a;throw"unknown op1: "+b;};y.ast.ASTOp2.prototype.exec=function(a){var b=this.op,c=this.right.exec(a);if("="===b)return e(a,this.left,c),c;a=this.left.exec(a);return g(b,a,c)};y.ast.ASTVar.prototype.exec=function(a){return a.vars(this.idName)};y.ast.ASTSlice.prototype.exec=function(a){var b=this.obj.exec(a),c=this.start.exec(a);return this.end?b.slice(c,this.end.exec(a)):b[c]};y.ast.ASTCall.prototype.exec=function(a){var b=this.funcName,c=[];this.args.items.forEach(function(b){c.push(b.exec(a))});
return d(a,b,c)};y.ast.ASTPass.prototype.exec=function(){};y.ast.ASTIf.prototype.exec=function(a){this.cond.exec(a)?this.body.exec(a):this.aElse.exec(a)};y.ast.ASTFor.prototype.exec=function(a){for(var b=this.aArray.exec(a),c=0;c<b.length;c++){e(a,this.aVar,b[c]);try{this.body.exec(a)}catch(d){if("BreakException"===d.name)break;else if("ContinueException"!==d.name)throw d;}}};y.ast.ASTWhile.prototype.exec=function(a){for(;this.cond.exec(a);)try{this.body.exec(a)}catch(b){if("BreakException"===b.name)break;
else if("ContinueException"!==b.name)throw b;}};y.ast.ASTReturn.prototype.exec=function(a){a=this.value.exec(a);throw new c(a);};y.ast.ASTBreak.prototype.exec=function(){throw new f;};y.ast.ASTContinue.prototype.exec=function(){throw new a;};y.ast.ASTBlock.prototype.exec=function(a){this.astList.forEach(function(b){b.exec(a)})};y.ast.ASTDef.prototype.exec=function(a){a.vars(this.funcName,this)};y.ast.ASTMember.prototype.exec=function(a){var b=this.obj.exec(a);if(this.idAst.type===y.AST.VAR)return b[this.idAst.idName];
var c=[];this.idAst.args.items.forEach(function(b){c.push(b.exec(a))});var f=this.idAst.funcName;try{return b[f].apply(b,c)}catch(e){return c.unshift(b),d(a,f,c)}};y.ast.ASTNew.prototype.exec=function(){throw"new \u306f\u672a\u5b9f\u88c5";}})();(function(){function d(c){this.lex=c;this.nextToken()}function c(c,a,d){this.name="ParseException";this.pos=c;this.token=a;this.message=d}y.Parser=d;d.prototype.error=function(d,a){var e=[];if(a){var g=[a.lineNo,a.col+1];e.push("(lineNo: ");e.push(a.lineNo);e.push(", column: ");e.push(a.col+1);e.push(") token type = ");e.push(a.typeStr);e.push(" [");e.push(a.lexeme);e.push("]:   ")}else g=[this.token.lineNo,this.token.col+1],e.push("(lineNo: "),e.push(this.token.lineNo),e.push(", column: "),e.push(this.token.col+
1),e.push("):   ");e.push(d);throw new c(g,a,e.join(""));};c.prototype.toString=function(){return this.message};d.prototype.parse=function(){this.skipEOL();return this.token.type===y.TOKEN.EOF?null:this.parseStatement()};d.prototype.nextToken=function(){return this.token=this.lex.getToken()};d.prototype.skipEOL=function(){for(;this.token.type===y.TOKEN.EOL;)this.nextToken()}})();(function(){function d(c){return c.type===y.AST.VAR||c.type===y.AST.SLICE&&!c.end||c.type===y.AST.MEMBER&&c.idAst.type===y.AST.VAR?!0:!1}y.Parser.prototype.parseStatement=function(){switch(this.token.type){case y.TOKEN.IF:return this.parseIf();case y.TOKEN.FOR:return this.parseFor();case y.TOKEN.WHILE:return this.parseWhile();case y.TOKEN.DEF:return this.parseDef();case y.TOKEN.RETURN:return this.parseReturn();case y.TOKEN.BREAK:return this.parseBreak();case y.TOKEN.CONTINUE:return this.parseContinue();
default:var c=this.parseExpression();if("="===this.token.lexeme)return d(c)||this.error("\u4ee3\u5165\u306e\u5de6\u5074\u306f\u5909\u6570\u3067\u306a\u3044\u3068\u3044\u3051\u307e\u305b\u3093"),this.parseAssign(c);this.checkEndStatement();return c}};y.Parser.prototype.checkEndStatement=function(){var c=this.token.type;c!==y.TOKEN.EOF&&c!==y.TOKEN.EOL&&c!==y.TOKEN.COMMENT&&this.error("\u4e88\u671f\u3057\u306a\u3044\u30c8\u30fc\u30af\u30f3",this.token)};y.Parser.prototype.parseBlock=function(){var c=
this.token;this.nextToken();this.token.type!==y.TOKEN.EOL&&this.error("':'  \u306e\u3042\u3068\u306b\u306f\u3001\u6539\u884c\u3092\u5165\u308c\u3066\u304f\u3060\u3055\u3044");this.nextToken();this.skipEOL();this.token.type===y.TOKEN.END_BLOCK&&this.error("\u30d6\u30ed\u30c3\u30af\u306e\u4e2d\u304c\u7a7a\u3067\u3059");for(var d=[];this.token.type!==y.TOKEN.END_BLOCK;){this.skipEOL();if(this.token.type===y.TOKEN.END_BLOCK)break;var a=this.parseStatement();d.push(a)}a=this.token;this.nextToken();return new y.ast.ASTBlock(c,
a,d)};y.Parser.prototype.parseIf=function(){this.nextToken();var c=this.parseExpression();this.token.type!==y.TOKEN.START_BLOCK&&("="===this.token.lexeme?this.error("if\u6761\u4ef6 \u306e\u4e2d\u3067\u4ee3\u5165\u306f\u3067\u304d\u307e\u305b\u3093"):this.error("\u300cif \u6761\u4ef6\u300d \u306e\u3042\u3068\u306e ':' \u304c\u629c\u3051\u3066\u3044\u307e\u3059"));var d=this.parseBlock();this.skipEOL();var a=null;this.token.type===y.TOKEN.ELIF?a=this.parseIf():this.token.type===y.TOKEN.ELSE&&(this.nextToken(),
a=this.parseBlock());return new y.ast.ASTIf(c,d,a)};y.Parser.prototype.parseFor=function(){this.nextToken();var c=this.parseExpression();d(c)||this.error("for \u306e\u3042\u3068\u306b\u306f\u5909\u6570\u540d\u3092\u66f8\u3044\u3066\u304f\u3060\u3055\u3044");this.token.type!==y.TOKEN.IN&&this.error("for \u306b in \u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f");this.nextToken();var f=this.parseExpression();this.token.type!==y.TOKEN.START_BLOCK&&this.error("\u300cfor\u300d \u306e\u3042\u3068\u306e ':' \u304c\u629c\u3051\u3066\u3044\u307e\u3059");
var a=this.parseBlock();return new y.ast.ASTFor(c,f,a)};y.Parser.prototype.parseWhile=function(){this.nextToken();var c=this.parseExpression();this.token.type!==y.TOKEN.START_BLOCK&&("="===this.token.lexeme?this.error("while\u6761\u4ef6 \u306e\u4e2d\u3067\u4ee3\u5165\u306f\u3067\u304d\u307e\u305b\u3093"):this.error("\u300cwhile \u6761\u4ef6\u300d \u306e\u3042\u3068\u306e ':' \u304c\u629c\u3051\u3066\u3044\u307e\u3059"));var d=this.parseBlock();return new y.ast.ASTWhile(c,d)};y.Parser.prototype.parseReturn=
function(){var c=this.token;this.nextToken();if(this.token.type!==y.TOKEN.EOL&&this.token.type!==y.TOKEN.EOF)var d=this.parseExpression();this.checkEndStatement();return new y.ast.ASTReturn(c,d)};y.Parser.prototype.parseBreak=function(){var c=this.token;this.nextToken();this.checkEndStatement();return new y.ast.ASTBreak(c)};y.Parser.prototype.parseContinue=function(){var c=this.token;this.nextToken();this.checkEndStatement();return new y.ast.ASTContinue(c)};y.Parser.prototype.parseDef=function(){this.nextToken();
this.token.type!==y.TOKEN.ID&&this.error("def \u306e\u3042\u3068\u306b\u306f\u95a2\u6570\u540d\u3092\u66f8\u3044\u3066\u304f\u3060\u3055\u3044",this.token);var c=new y.ast.ASTVar(this.token);this.nextToken();"("!==this.token.lexeme&&this.error("\u300cdef \u95a2\u6570\u540d\u300d \u306e\u3042\u3068\u306b '(' \u304c\u3042\u308a\u307e\u305b\u3093",this.token);var d=this.parseList(")"),a=this;d.items.forEach(function(c){c.type!==y.AST.VAR&&a.error("\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u306f\u5f15\u6570\u540d\u3092\u66f8\u3044\u3066\u304f\u3060\u3055\u3044",
c.token)});var e=this.parseBlock();return new y.ast.ASTDef(c,d,e)};y.Parser.prototype.parseAssign=function(c){var d=this.token;this.nextToken();var a=this.parseExpression();this.checkEndStatement();return new y.ast.ASTOp2(d,c,a)}})();(function(){var d={or:5,and:7,"==":11,"!=":11,"<":11,"<=":11,">":11,">=":11,"+":21,"-":21,"*":41},c={or:4,and:6,"==":10,"!=":10,"<":10,"<=":10,">":10,">=":10,"+":20,"-":20,"*":40};y.Parser.prototype.parseExpression=function(){var c=this.parsePrimary();return this.parseOp2RHS({left:0,right:0},c)};y.Parser.prototype.parseOp2RHS=function(c,a){for(;;){var d=this.getPrecedence();if(c.left>d.right)return a;var g=this.token;this.nextToken();var h=this.parsePrimary(),b=this.getPrecedence();d.left<b.right&&
(h=this.parseOp2RHS(d,h));a.type===y.AST.NUMBER&&h.type===y.AST.NUMBER?(d=y.runOp(g.lexeme,a.num,h.num),a=new y.ast.ASTNumber({lineNo:a.lineNo,lexeme:""+d})):a=new y.ast.ASTOp2(g,a,h)}};y.Parser.prototype.getPrecedence=function(){var f=this.token.lexeme;return f in d?{left:d[f],right:c[f]}:{left:-1,right:-1}}})();(function(){y.Parser.prototype.parsePrimary=function(){var d;switch(this.token.type){case y.TOKEN.NUMBER:d=this.parseNumber();break;case y.TOKEN.STRING:d=this.parseString();break;case y.TOKEN.ID:d=this.parseID();break;case 91:d=this.parseList("]");break;case 123:d=this.parseMap();break;case 40:d=this.parseParen();break;case 45:case 110:d=this.parseOp1();break;case y.TOKEN.FLOAT:d=this.parseFloat();break;case y.TOKEN.NEW:d=this.parseNew();break;default:return this.error("\u4e88\u671f\u3057\u306a\u3044\u30c8\u30fc\u30af\u30f3 (in parsePrimary)",
this.token),null}for(;"."===this.token.lexeme;)d=this.parseMember(d);for(;"["===this.token.lexeme;)d=this.parseSlice(d);return d};y.Parser.prototype.parseMember=function(d){this.nextToken();this.token.type!==y.TOKEN.ID&&this.error("'.' \u306e\u3046\u3057\u308d\u306b\u4e88\u671f\u3057\u306a\u3044\u30c8\u30fc\u30af\u30f3\u304c\u3042\u308a\u307e\u3059",this.token);var c=this.parseID();return new y.ast.ASTMember(d,c)};y.Parser.prototype.parseNumber=function(){var d=new y.ast.ASTNumber(this.token);this.nextToken();
return d};y.Parser.prototype.parseFloat=function(){var d=new y.ast.ASTNumber(this.token,!0);this.nextToken();return d};y.Parser.prototype.parseString=function(){var d=new y.ast.ASTString(this.token);this.nextToken();return d};y.Parser.prototype.parseOp1=function(){var d=this.token;this.nextToken();var c=this.parseExpression();return new y.ast.ASTOp1(d,c)};y.Parser.prototype.parseParen=function(){this.nextToken();var d=this.parseExpression();")"!==this.token.lexeme&&this.error("\u9589\u3058\u30ab\u30c3\u30b3 ')' \u304c\u629c\u3051\u3066\u3044\u307e\u3059");
this.nextToken();return d};y.Parser.prototype.parseID=function(){var d=new y.ast.ASTVar(this.token);this.nextToken();if("("!==this.token.lexeme)return d;var c=this.parseList(")");return new y.ast.ASTCall(d,c)};y.Parser.prototype.parseList=function(d){var c=this.token;this.nextToken();var f=[];if(this.token.lexeme!==d)for(;;){var a=this.parseExpression();f.push(a);if(this.token.lexeme===d)break;","!==this.token.lexeme&&this.error("',' \u304c\u629c\u3051\u3066\u3044\u307e\u3059");this.nextToken()}this.token.lexeme!==
d&&this.error(d+" \u304c\u6765\u308b\u306f\u305a",this.token);d=this.token;this.nextToken();return new y.ast.ASTList(c,d,f)};y.Parser.prototype.parseMap=function(){var d=this.token;this.nextToken();var c=[],f=[];if("}"!==this.token.lexeme)for(;;){var a=this.parseExpression();c.push(a);":"!==this.token.lexeme&&this.error("':' \u304c\u629c\u3051\u3066\u3044\u307e\u3059");this.nextToken();a=this.parseExpression();f.push(a);if("}"===this.token.lexeme)break;","!==this.token.lexeme&&this.error("',' \u304c\u629c\u3051\u3066\u3044\u307e\u3059");
this.nextToken()}"}"!==this.token.lexeme&&this.error("'}' \u304c\u6765\u308b\u306f\u305a",this.token);a=this.token;this.nextToken();return new y.ast.ASTDict(d,a,c,f)};y.Parser.prototype.parseSlice=function(d){this.nextToken();var c=this.parseExpression(),f;":"===this.token.lexeme&&(this.nextToken(),f=this.parseExpression());"]"!==this.token.lexeme&&this.error("']' \u304c\u629c\u3051\u3066\u3044\u307e\u3059",this.token);this.nextToken();return new y.ast.ASTSlice(d,c,f)};y.Parser.prototype.parseNew=
function(){this.nextToken();var d=this.parseID();d.type!==y.AST.CALL&&this.error("'new' \u306e\u3042\u3068\u306b\u306f\u95a2\u6570\u547c\u3073\u51fa\u3057\u5f62\u5f0f\u304c\u6765\u308b\u306f\u305a");return new y.ast.ASTNew(d)}})();(function(){function d(c){this.parent=c;this.varsMap={};this.varsList=[];c=c?this.getTopLevelEnv():this;c.notifyNewEnv&&c.notifyNewEnv()}y.Env=d;y.createTopLevelEnv=function(){var c=new d;helpers.createEvent(c,"ChangeVar");helpers.createEvent(c,"NewEnv");helpers.createEvent(c,"DeleteEnv");return c};d.prototype.vars=function(c,d){if(1>=arguments.length)return this.refVar(c);if(c in this.varsMap)var a=!1;else a=!0,this.varsList.push(c);this.varsMap[c]=d;var e=this.varsList.indexOf(c),g=this.getTopLevelEnv();
g.notifyChangeVar&&g.notifyChangeVar(c,d,a,e);return this};d.prototype.varsForEach=function(c){var d=this.varsMap;this.varsList.forEach(function(a){c(a,d[a])})};d.prototype.refVar=function(c){if(c in this.varsMap)return this.varsMap[c];if(this.parent)return this.parent.refVar(c);throw"undefined variable: "+c;};d.prototype.getTopLevelEnv=function(){return this.parent?this.parent.getTopLevelEnv():this}})();(function(){function d(){var d=document.getElementById("src").value;p="";k.innerHTML="";m.innerHTML="";c();b=y.createTopLevelEnv();b.vars("print",function(a){p+=a.toString()+"\n";k.innerHTML=p;k.scrollTop=k.scrollHeight});var n=b;b=new y.Env(n);n.addNewEnvListener(c);n.addDeleteEnvListener(f);n.addChangeVarListener(a);d=new y.Lex(d);g=new y.Parser(d);try{(h=g.parse())?e.root(h).update():e.root({}).update()}catch(l){m.innerHTML=l}}function c(){for(var a=l.rows.length-1;0<a;a--)l.deleteRow(a)}function f(b){c();
b.varsForEach(function(b,c){a(b,c,!0,-1)})}function a(a,b,c,d){c?(d=l.rows.length-1,c=l.insertRow(-1),c.className="vars-"+d,c.insertCell(0),c.insertCell(1)):c=l.getElementsByClassName("vars-"+d)[0];b=b.type===y.AST.DEF?"[function "+b.funcName.idName+"]":b.toString();c.childNodes[0].innerHTML=a;c.childNodes[1].innerHTML=b}window.yaseuma=function(){k=document.getElementById("console");l=document.getElementById("vars-table");m=document.getElementById("err-message");var a=document.getElementById("ast-svg");
e=vtree(a,840,600);d()};window.stepRun=function(){try{h&&h.exec(b),(h=g.parse())?e.root(h).update():e.root({nodeText:"EOF"}).update()}catch(a){m.innerHTML=a}};window.loadSrc=d;var e,g,h,b,l,k,m,p=""})();
